{% extends "base.html" %}


{% block head %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/main/playgrounds.css' %}">
{% endblock %}

{% block body %}
    <div class="map">
        <script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3A701e7e69cbcaded6365aa0d45c70ad4f619c3d9af1cfcf49622b30b431a0e155&amp;width=100%25&amp;height=400&amp;lang=ru_RU&amp;scroll=true"></script>
    </div>

    <script>
        ymaps.ready(init);

        function init() {

            // Создание экземпляра карты.
            var myMap = new ymaps.Map('map', {
                    center: [50.443705, 30.530946],
                    zoom: 14
                }, {
                    searchControlProvider: 'yandex#search'
                }),
                // Контейнер для меню.
                menu = $('<ul class="menu"></ul>');
                
            for (var i = 0, l = groups.length; i < l; i++) {
                createMenuGroup(groups[i]);
            }

            function createMenuGroup (group) {
                // Пункт меню.
                var menuItem = $('<li><a href="#">' + group.name + '</a></li>'),
                // Коллекция для геообъектов группы.
                    collection = new ymaps.GeoObjectCollection(null, { preset: group.style }),
                // Контейнер для подменю.
                    submenu = $('<ul class="submenu"></ul>');

                // Добавляем коллекцию на карту.
                myMap.geoObjects.add(collection);
                // Добавляем подменю.
                menuItem
                    .append(submenu)
                    // Добавляем пункт в меню.
                    .appendTo(menu)
                    // По клику удаляем/добавляем коллекцию на карту и скрываем/отображаем подменю.
                    .find('a')
                    .bind('click', function () {
                        if (collection.getParent()) {
                            myMap.geoObjects.remove(collection);
                            submenu.hide();
                        } else {
                            myMap.geoObjects.add(collection);
                            submenu.show();
                        }
                    });
                for (var j = 0, m = group.items.length; j < m; j++) {
                    createSubMenu(group.items[j], collection, submenu);
                }
            }

            function createSubMenu (item, collection, submenu) {
                // Пункт подменю.
                var submenuItem = $('<li><a href="#">' + item.name + '</a></li>'),
                // Создаем метку.
                    placemark = new ymaps.Placemark(item.center, { balloonContent: item.name });

                // Добавляем метку в коллекцию.
                collection.add(placemark);
                // Добавляем пункт в подменю.
                submenuItem
                    .appendTo(submenu)
                    // При клике по пункту подменю открываем/закрываем баллун у метки.
                    .find('a')
                    .bind('click', function () {
                        if (!placemark.balloon.isOpen()) {
                            placemark.balloon.open();
                        } else {
                            placemark.balloon.close();
                        }
                        return false;
                    });
            }

            // Добавляем меню в тэг BODY.
            menu.appendTo($('body'));
            // Выставляем масштаб карты чтобы были видны все группы.
            myMap.setBounds(myMap.geoObjects.getBounds());
        }
    </script>

    <div class="items_cell">
        {% for p in list_playground %}
            <div class="item">
                <div class="photo">
                    <img src="{{ p.photo.url }}" alt="">
                </div>
                <div class="item_info">
                    <div class="text">
                        <div class="address">
                                {{ p.address }}
                        </div>

                        <div class="description">
                            {{ p.description }}
                        </div>
                    </div>
                    
                    
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}